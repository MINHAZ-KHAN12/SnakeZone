<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Snake Zone (Game)</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="body">
    <div id="scoreBox">Score: 0</div>

    <div class="hi-pause-container">
      <button id="pauseBtn">‚è∏Ô∏è Pause</button>
    </div>

    <div id="board"></div>
  </div>

  <script>
    // Game Setup
    let inputDir = { x: 0, y: 0 };
    const foodSound = new Audio('music/food.mp3');
    const gameOverSound = new Audio('music/gameover.mp3');
    const moveSound = new Audio('music/move.mp3');
    const musicSound = new Audio('music/music.mp3');

    let speed = 8;
    let score = 0;
    let lastPaintTime = 0;
    let isPaused = false;
    const boardSize = 18;

    let snakeArr = [{ x: 13, y: 15 }];
    let food = { x: 6, y: 7 };

    const board = document.getElementById("board");
    const scoreBox = document.getElementById("scoreBox");
    const pauseBtn = document.getElementById("pauseBtn");

    // Pause Button Logic
    pauseBtn.addEventListener("click", () => {
      isPaused = !isPaused;
      pauseBtn.textContent = isPaused ? "‚ñ∂Ô∏è Resume" : "‚è∏Ô∏è Pause";
    });

    // Game Loop
    function main(ctime) {
      window.requestAnimationFrame(main);
      if (isPaused) return;
      if ((ctime - lastPaintTime) / 1000 < 1 / speed) return;
      lastPaintTime = ctime;
      gameEngine();
    }

    // Collision Check
    function isCollide(snake) {
      for (let i = 1; i < snake.length; i++) {
        if (snake[i].x === snake[0].x && snake[i].y === snake[0].y) return true;
      }
      if (
        snake[0].x <= 0 || snake[0].x > boardSize ||
        snake[0].y <= 0 || snake[0].y > boardSize
      ) return true;
      return false;
    }

    // Head Rotation
    function updateHeadRotation(dir) {
      const head = document.getElementById("snake-head");
      if (!head) return;
      let angle = 0;
      if (dir.x === 0 && dir.y === -1) angle = 0;
      else if (dir.x === 1 && dir.y === 0) angle = 90;
      else if (dir.x === 0 && dir.y === 1) angle = 180;
      else if (dir.x === -1 && dir.y === 0) angle = 270;
      head.style.transform = `rotate(${angle}deg)`;
    }

    // Game Engine
    function gameEngine() {
      if (isCollide(snakeArr)) {
        gameOverSound.play();
        musicSound.pause();
        inputDir = { x: 0, y: 0 };
        localStorage.setItem("latestScore", score);
        window.location.href = "gameover.html";
        return;
      }

      // Eat Food
      if (snakeArr[0].x === food.x && snakeArr[0].y === food.y) {
        foodSound.play();
        score++;
        scoreBox.innerHTML = "Score: " + score;

        snakeArr.unshift({
          x: snakeArr[0].x + inputDir.x,
          y: snakeArr[0].y + inputDir.y
        });

        let a = 2, b = 16;
        food = {
          x: Math.round(a + (b - a) * Math.random()),
          y: Math.round(a + (b - a) * Math.random())
        };
      }

      // Move Snake
      for (let i = snakeArr.length - 2; i >= 0; i--) {
        snakeArr[i + 1] = { ...snakeArr[i] };
      }

      snakeArr[0].x += inputDir.x;
      snakeArr[0].y += inputDir.y;

      // Render Snake & Food
      board.innerHTML = "";
      snakeArr.forEach((e, index) => {
        const segment = document.createElement('div');
        segment.style.gridRowStart = e.y;
        segment.style.gridColumnStart = e.x;
        if (index === 0) {
          segment.classList.add('head');
          segment.id = "snake-head";
        } else {
          segment.classList.add('snake');
          segment.style.opacity = `${1 - index * 0.05}`;
        }
        board.appendChild(segment);
      });

      updateHeadRotation(inputDir);

      const foodEl = document.createElement('div');
      foodEl.style.gridRowStart = food.y;
      foodEl.style.gridColumnStart = food.x;
      foodEl.classList.add('food');
      foodEl.textContent = "üçé";
      board.appendChild(foodEl);
    }

    // Start Game
    musicSound.play();
    window.requestAnimationFrame(main);

    // Keyboard Controls
    window.addEventListener('keydown', e => {
      if (e.key === "p" || e.key === "P") {
        isPaused = !isPaused;
        pauseBtn.textContent = isPaused ? "‚ñ∂Ô∏è Resume" : "‚è∏Ô∏è Pause";
        return;
      }
      if (isPaused) return;

      moveSound.play();
      switch (e.key) {
        case "ArrowUp":
          if (inputDir.y !== 1) inputDir = { x: 0, y: -1 };
          break;
        case "ArrowDown":
          if (inputDir.y !== -1) inputDir = { x: 0, y: 1 };
          break;
        case "ArrowLeft":
          if (inputDir.x !== 1) inputDir = { x: -1, y: 0 };
          break;
        case "ArrowRight":
          if (inputDir.x !== -1) inputDir = { x: 1, y: 0 };
          break;
      }
    });
  </script>
</body>
</html>
